/*! For license information please see app~28c8c3f7.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkkalkulori=self.webpackChunkkalkulori||[]).push([[174],{991:(e,t,a)=>{a.d(t,{A:()=>_});var r=a(938),n=a(774),i=a(176),s=a(275);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){d(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function d(e,t,a){return(t=v(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function u(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return g(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?g(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==a.return||a.return()}finally{if(o)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}function h(){h=function(){return t};var e,t={},a=Object.prototype,r=a.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",l=n.toStringTag||"@@toStringTag";function c(e,t,a,r){return Object.defineProperty(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r})}try{c({},"")}catch(e){c=function(e,t,a){return e[t]=a}}function d(t,a,r,n){var i=a&&a.prototype instanceof m?a:m,s=Object.create(i.prototype);return c(s,"_invoke",function(t,a,r){var n=1;return function(i,s){if(3===n)throw Error("Generator is already running");if(4===n){if("throw"===i)throw s;return{value:e,done:!0}}for(r.method=i,r.arg=s;;){var o=r.delegate;if(o){var l=S(o,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===n)throw n=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=3;var c=u(t,a,r);if("normal"===c.type){if(n=r.done?4:2,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=4,r.method="throw",r.arg=c.arg)}}}(t,r,new I(n||[])),!0),s}function u(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var g={};function m(){}function p(){}function f(){}var v={};c(v,i,(function(){return this}));var _=Object.getPrototypeOf,y=_&&_(_(M([])));y&&y!==a&&r.call(y,i)&&(v=y);var b=f.prototype=m.prototype=Object.create(v);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function a(n,i,s,l){var c=u(e[n],e,i);if("throw"!==c.type){var d=c.arg,g=d.value;return g&&"object"==o(g)&&r.call(g,"__await")?t.resolve(g.__await).then((function(e){a("next",e,s,l)}),(function(e){a("throw",e,s,l)})):t.resolve(g).then((function(e){d.value=e,s(d)}),(function(e){return a("throw",e,s,l)}))}l(c.arg)}var n;c(this,"_invoke",(function(e,r){function i(){return new t((function(t,n){a(e,r,t,n)}))}return n=n?n.then(i,i):i()}),!0)}function S(t,a){var r=a.method,n=t.i[r];if(n===e)return a.delegate=null,"throw"===r&&t.i.return&&(a.method="return",a.arg=e,S(t,a),"throw"===a.method)||"return"!==r&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=u(n,t.i,a.arg);if("throw"===i.type)return a.method="throw",a.arg=i.arg,a.delegate=null,g;var s=i.arg;return s?s.done?(a[t.r]=s.value,a.next=t.n,"return"!==a.method&&(a.method="next",a.arg=e),a.delegate=null,g):s:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,g)}function P(e){this.tryEntries.push(e)}function C(t){var a=t[4]||{};a.type="normal",a.arg=e,t[4]=a}function I(e){this.tryEntries=[[-1]],e.forEach(P,this),this.reset(!0)}function M(t){if(null!=t){var a=t[i];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,s=function a(){for(;++n<t.length;)if(r.call(t,n))return a.value=t[n],a.done=!1,a;return a.value=e,a.done=!0,a};return s.next=s}}throw new TypeError(o(t)+" is not iterable")}return p.prototype=f,c(b,"constructor",f),c(f,"constructor",p),p.displayName=c(f,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,l,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},w(k.prototype),c(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,a,r,n,i){void 0===i&&(i=Promise);var s=new k(d(e,a,r,n),i);return t.isGeneratorFunction(a)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(b),c(b,l,"Generator"),c(b,i,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),a=[];for(var r in t)a.unshift(r);return function e(){for(;a.length;)if((r=a.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},t.values=M,I.prototype={constructor:I,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var a in this)"t"===a.charAt(0)&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var a=this;function r(e){s.type="throw",s.arg=t,a.next=e}for(var n=a.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],s=i[4],o=this.prev,l=i[1],c=i[2];if(-1===i[0])return r("end"),!1;if(!l&&!c)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=o){if(o<l)return this.method="next",this.arg=e,r(l),!0;if(o<c)return r(c),!1}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var n=r;break}}n&&("break"===e||"continue"===e)&&n[0]<=t&&t<=n[2]&&(n=null);var i=n?n[4]:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n[2],g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a[2]===e)return this.complete(a[4],a[3]),C(a),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a[0]===e){var r=a[4];if("throw"===r.type){var n=r.arg;C(a)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,a,r){return this.delegate={i:M(t),r:a,n:r},"next"===this.method&&(this.arg=e),g}},t}function m(e,t,a,r,n,i,s){try{var o=e[i](s),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(r,n)}function p(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var i=e.apply(t,a);function s(e){m(i,r,n,s,o,"next",e)}function o(e){m(i,r,n,s,o,"throw",e)}s(void 0)}))}}function f(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,v(r.key),r)}}function v(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}const _=function(){return e=function e(t){var a=t.container;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=a,this.lastFetchDate=null,this.data={currentCalories:0,calorieLimit:1500,selectedKeywords:[],dailyLog:null,mealEntries:[],loading:!0,error:null,currentCategory:null,mealPlan:{plans:[],totalCalories:0,targetCalories:1500,loading:!1,error:null},suggestedMeals:[{name:"Chicken Soto",image:"./public/image/meals/chicken-soto.jpg",calories:312},{name:"Fried Noodles",image:"./public/image/meals/fried-noodles.jpg",calories:280},{name:"Meatballs Soup",image:"./public/image/meals/meatballs-soup.jpg",calories:283},{name:"Noodles Soup",image:"./public/image/meals/noodles-soup.jpg",calories:137}],mealSuggestions:{loading:!1,error:null,data:[],isFromAPI:!1}},this.eventHandlers={onAddMealClicked:this._handleAddMeal.bind(this),onDeleteMealClicked:this._handleDeleteMeal.bind(this),onCategoryClicked:this._handleCategoryClicked.bind(this),onPopupClosed:this._handlePopupClosed.bind(this),onFindMealsClicked:this._handleFindMeals.bind(this),onClearAllClicked:this._handleClearAll.bind(this),onKeywordRemoved:this._handleKeywordRemoved.bind(this),onGenerateMealPlan:this._handleGenerateMealPlan.bind(this),onMealPlanItemClicked:this._handleMealPlanItemClicked.bind(this),onCompleteProfileClicked:this._handleCompleteProfile.bind(this),onSuggestedMealClicked:this._handleSuggestedMealClicked.bind(this),onSuggestedMealDetailsClicked:this._handleSuggestedMealDetailsClicked.bind(this)},this._bindCustomEvents(),this._startDayChangeMonitor()},t=[{key:"init",value:(b=p(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,window.mealApiService=n.A,this._checkAndResetForNewDay(),this._loadFromSessionStorage(),this.data.loading=!0,this._renderView(),e.next=8,this._fetchDailyData();case 8:return e.next=10,this._fetchMealPlan();case 10:e.next=18;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Failed to initialize Home page:",e.t0),this.data.error="Failed to load daily data",this.data.loading=!1,this._renderView();case 18:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return b.apply(this,arguments)})},{key:"_getCurrentUserId",value:function(){return localStorage.getItem("userId")||"anonymous"}},{key:"_startDayChangeMonitor",value:function(){var e=this;setInterval((function(){e._checkAndResetForNewDay()}),6e4)}},{key:"_checkAndResetForNewDay",value:function(){var e=this._getTodayString(),t=this._getCurrentUserId(),a="lastAppDate_".concat(t);localStorage.getItem(a)!==e&&(console.log("New day detected, resetting data for user:",t),localStorage.setItem(a,e),["mealSuggestions_".concat(t),"dailyLogs_".concat(t),"mealPlan_".concat(t)].forEach((function(e){sessionStorage.removeItem(e)})),this.data.selectedKeywords=[],this.data.mealSuggestions={loading:!1,error:null,data:[],isFromAPI:!1},this.data.suggestedMeals=[{name:"Chicken Soto",image:"./public/image/meals/chicken-soto.jpg",calories:312},{name:"Fried Noodles",image:"./public/image/meals/fried-noodles.jpg",calories:280},{name:"Meatballs Soup",image:"./public/image/meals/meatballs-soup.jpg",calories:283},{name:"Noodles Soup",image:"./public/image/meals/noodles-soup.jpg",calories:137}],this.data.currentCalories=0,this.data.mealEntries=[],this.data.dailyLog=null,this.data.mealPlan={plans:[],totalCalories:0,targetCalories:1500,loading:!1,error:null},this.lastFetchDate=null,this.container&&this.container.innerHTML&&(this._fetchDailyData(),this._fetchMealPlan()))}},{key:"_getTodayString",value:function(){var e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)}},{key:"_saveToSessionStorage",value:function(){var e=this._getTodayString(),t=this._getCurrentUserId(),a={date:e,userId:t,selectedKeywords:this.data.selectedKeywords,mealSuggestions:{loading:!1,error:this.data.mealSuggestions.error,data:this.data.mealSuggestions.data,isFromAPI:this.data.mealSuggestions.isFromAPI},suggestedMeals:this.data.suggestedMeals};sessionStorage.setItem("mealSuggestions_".concat(t),JSON.stringify(a));var r={date:e,userId:t,currentCalories:this.data.currentCalories,calorieLimit:this.data.calorieLimit,dailyLog:this.data.dailyLog,mealEntries:this.data.mealEntries,lastFetchDate:this.lastFetchDate};sessionStorage.setItem("dailyLogs_".concat(t),JSON.stringify(r));var n={date:e,userId:t,mealPlan:this.data.mealPlan};sessionStorage.setItem("mealPlan_".concat(t),JSON.stringify(n))}},{key:"_loadFromSessionStorage",value:function(){var e=this._getTodayString(),t=this._getCurrentUserId();try{var a=sessionStorage.getItem("mealSuggestions_".concat(t));if(a){var r,n,i=JSON.parse(a);i.date===e&&i.userId===t?(this.data.selectedKeywords=i.selectedKeywords||[],this.data.mealSuggestions={loading:!1,error:null,data:(null===(r=i.mealSuggestions)||void 0===r?void 0:r.data)||[],isFromAPI:(null===(n=i.mealSuggestions)||void 0===n?void 0:n.isFromAPI)||!1},this.data.suggestedMeals=i.suggestedMeals||this.data.suggestedMeals,console.log("Restored meal suggestions from session storage for user:",t)):sessionStorage.removeItem("mealSuggestions_".concat(t))}var s=sessionStorage.getItem("dailyLogs_".concat(t));if(s){var o=JSON.parse(s);o.date===e&&o.userId===t?(this.data.currentCalories=o.currentCalories||0,this.data.calorieLimit=o.calorieLimit||1500,this.data.dailyLog=o.dailyLog,this.data.mealEntries=o.mealEntries||[],this.lastFetchDate=o.lastFetchDate,console.log("Restored daily logs from session storage for user:",t)):sessionStorage.removeItem("dailyLogs_".concat(t))}var l=sessionStorage.getItem("mealPlan_".concat(t));if(l){var c=JSON.parse(l);c.date===e&&c.userId===t&&c.mealPlan?(this.data.mealPlan=c.mealPlan,console.log("Restored meal plan from session storage for user:",t)):sessionStorage.removeItem("mealPlan_".concat(t))}}catch(e){console.error("Error loading from session storage:",e),sessionStorage.removeItem("mealSuggestions_".concat(t)),sessionStorage.removeItem("dailyLogs_".concat(t)),sessionStorage.removeItem("mealPlan_".concat(t))}}},{key:"_fetchDailyData",value:(y=p(h().mark((function e(){var t,a,r,i,s=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]&&s[0],e.prev=1,a=this._getTodayString(),r=this._getCurrentUserId(),t||this.lastFetchDate!==a||!(this.data.mealEntries.length>0)){e.next=8;break}return this.data.loading=!1,this._renderView(),e.abrupt("return");case 8:return e.next=10,n.A.getDailyLog(a);case 10:return i=e.sent,this.data.dailyLog=i.daily_log,console.log("📊 Raw meal entries from API for user",r,":",i.meal_entries),e.next=15,this._enrichMealEntries(i.meal_entries||[]);case 15:this.data.mealEntries=e.sent,console.log("✨ Enriched meal entries for user",r,":",this.data.mealEntries),this.data.currentCalories=i.daily_log.total_calories_consumed||0,void 0!==i.daily_log.remaining_calories&&(this.data.calorieLimit=this.data.currentCalories+i.daily_log.remaining_calories),this.lastFetchDate=a,this._saveToSessionStorage(),e.next=31;break;case 23:e.prev=23,e.t0=e.catch(1),console.error("Error fetching daily data for user",this._getCurrentUserId(),":",e.t0),this.data.error="Unable to load today's data",this.data.currentCalories=0,this.data.calorieLimit=1500,this.data.mealEntries=[],this.data.dailyLog=null;case 31:return e.prev=31,this.data.loading=!1,this._renderView(),e.finish(31);case 35:case"end":return e.stop()}}),e,this,[[1,23,31,35]])}))),function(){return y.apply(this,arguments)})},{key:"_enrichMealEntries",value:(_=p(h().mark((function e(t){var a,r,i,s,o,l,d,g,m,p,f,v,_,y,b,w;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],r=u(t),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=43;break}if(s=i.value,o=c({},s),l=s.id,!o.calories&&o.calories_consumed&&(o.calories=o.calories_consumed),!o.protein&&o.protein_consumed&&(o.protein=o.protein_consumed),!o.carbs&&o.carbs_consumed&&(o.carbs=o.carbs_consumed),!o.fat&&o.fat_consumed&&(o.fat=o.fat_consumed),!s.is_from_recipe&&!s.is_from_search||!s.recipe_id){e.next=37;break}return e.prev=13,e.next=16,n.A.getMealDetails(s.recipe_id);case 16:if(!(d=e.sent)||!d.meal){e.next=23;break}g=d.meal,o.food_details={id:s.is_from_search?s.food_item_id:"recipe_".concat(s.recipe_id),food_name:g.food_name||s.food_name||(s.is_from_search?"Search Result":"Recipe Meal"),calories_per_serving:g.calories_per_serving,protein_per_serving:g.protein_per_serving,carbs_per_serving:g.carbs_per_serving,fat_per_serving:g.fat_per_serving,serving_size:g.serving_size,serving_unit:g.serving_unit,image_url:g.image_url,is_recipe:!!s.is_from_recipe,is_from_search:!!s.is_from_search,recipe_id:s.recipe_id},console.log("✅ Successfully enriched ".concat(s.is_from_search?"search":"recipe"," meal:"),o.food_details.food_name,"with image:",o.food_details.image_url),e.next=24;break;case 23:throw new Error("No meal details found");case 24:e.next=35;break;case 26:e.prev=26,e.t0=e.catch(13),console.warn("Could not fetch ".concat(s.is_from_search?"search":"recipe"," meal details:"),e.t0),m=Math.round((s.calories||s.calories_consumed||0)/(s.servings||1)),p=parseFloat(((s.protein||s.protein_consumed||0)/(s.servings||1)).toFixed(2)),f=parseFloat(((s.carbs||s.carbs_consumed||0)/(s.servings||1)).toFixed(2)),v=parseFloat(((s.fat||s.fat_consumed||0)/(s.servings||1)).toFixed(2)),o.food_details={id:s.food_item_id,food_name:s.food_name||(s.is_from_search?"Search Result":"Recipe Meal"),calories_per_serving:m,protein_per_serving:p,carbs_per_serving:f,fat_per_serving:v,serving_size:1,serving_unit:"serving",image_url:null,is_recipe:!!s.is_from_recipe,is_from_search:!!s.is_from_search,recipe_id:s.recipe_id},console.log("⚠️ Using fallback data for ".concat(s.is_from_search?"search":"recipe"," meal:"),o.food_details.food_name);case 35:e.next=38;break;case 37:s.food_details?o.food_details=s.food_details:(_=Math.round((s.calories||s.calories_consumed||0)/(s.servings||1)),y=parseFloat(((s.protein||s.protein_consumed||0)/(s.servings||1)).toFixed(2)),b=parseFloat(((s.carbs||s.carbs_consumed||0)/(s.servings||1)).toFixed(2)),w=parseFloat(((s.fat||s.fat_consumed||0)/(s.servings||1)).toFixed(2)),o.food_details={id:s.food_item_id,food_name:s.food_name||"Unknown Food",calories_per_serving:_,protein_per_serving:y,carbs_per_serving:b,fat_per_serving:w,serving_size:1,serving_unit:"serving",image_url:null});case 38:o.id=l,o._debug_info={original_id:l,user_id:s.user_id,is_from_recipe:s.is_from_recipe,is_from_search:s.is_from_search,recipe_id:s.recipe_id,food_item_id:s.food_item_id},a.push(o);case 41:e.next=4;break;case 43:e.next=48;break;case 45:e.prev=45,e.t1=e.catch(2),r.e(e.t1);case 48:return e.prev=48,r.f(),e.finish(48);case 51:return e.abrupt("return",a);case 52:case"end":return e.stop()}}),e,null,[[2,45,48,51],[13,26]])}))),function(e){return _.apply(this,arguments)})},{key:"_fetchMealPlan",value:(v=p(h().mark((function e(){var t,a,r,s,o,l,c,d=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]&&d[0],e.prev=1,this._getTodayString(),r=this._getCurrentUserId(),s=this.data.mealPlan.plans&&this.data.mealPlan.plans.length>0,t||!s){e.next=8;break}return console.log("🍽️ Using cached meal plan for user:",r),e.abrupt("return");case 8:return this.data.mealPlan.loading=!0,this.data.mealPlan.error=null,this._renderView(),console.log("🍽️ Fetching meal plan for user:",r),e.next=14,n.A.generateMealPlan();case 14:if(o=e.sent,console.log("✅ Meal plan data received for user",r,":",o),l=(0,i.Gj)(o),Array.isArray(l)&&0!==l.length){e.next=20;break}throw console.error("❌ formatMealPlanData returned invalid data:",l),new Error("Failed to format meal plan data");case 20:this.data.mealPlan.plans=l,this.data.mealPlan.totalCalories=(0,i.jy)(this.data.mealPlan.plans),this.data.mealPlan.targetCalories=(null===(a=o.user_info)||void 0===a?void 0:a.daily_calorie_target)||1500,this._saveToSessionStorage(),console.log("✅ Meal plan formatted successfully for user:",r),e.next=34;break;case 27:e.prev=27,e.t0=e.catch(1),console.error("💥 Error fetching meal plan for user",this._getCurrentUserId(),":",e.t0),c="Unable to load meal plan",e.t0.message.includes("Authentication")||e.t0.message.includes("login")?c="Authentication required. Please login again.":e.t0.message.includes("Profile not found")||e.t0.message.includes("404")?c="Please complete your profile first":e.t0.message.includes("Daily calorie target")||e.t0.message.includes("400")?c="Please set your daily calorie target in profile":e.t0.message.includes("Server error")||e.t0.message.includes("500")?c="Profile setup required. Please complete your profile.":e.t0.message.includes("503")||e.t0.message.includes("ML service")?c="Meal plan service temporarily unavailable":e.t0.message.includes("504")||e.t0.message.includes("timeout")?c="Request timeout. Please try again":e.t0.message.includes("connect")||e.t0.message.includes("network")||e.t0.message.includes("Network error")?c="Connection error. Please check your internet":e.t0.message.includes("No meal plans available")||e.t0.message.includes("No meal plans generated")?c="No meal plans generated. Please try again.":e.t0.message.includes("Invalid")&&(c="Invalid data received. Please try again."),this.data.mealPlan.error=c,e.t0.message.includes("Authentication")||e.t0.message.includes("login")?(this.data.mealPlan.plans=[],this.data.mealPlan.totalCalories=0):(this.data.mealPlan.plans=(0,i.aI)(),this.data.mealPlan.totalCalories=(0,i.jy)(this.data.mealPlan.plans),console.log("📋 Using default meal plan as fallback for user:",this._getCurrentUserId()));case 34:return e.prev=34,this.data.mealPlan.loading=!1,this._renderView(),e.finish(34);case 38:case"end":return e.stop()}}),e,this,[[1,27,34,38]])}))),function(){return v.apply(this,arguments)})},{key:"_bindCustomEvents",value:function(){var e=this;document.addEventListener("keywordToggled",(function(t){e._handleKeywordToggled(t.detail.keyword,t.detail.selected)})),document.addEventListener("mealPlanMealAdded",(function(){console.log("🔄 Meal plan meal added, refreshing data for user:",e._getCurrentUserId()),e._refreshDailyData()}))}},{key:"_refreshDailyData",value:(m=p(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._fetchDailyData(!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error refreshing daily data for user",this._getCurrentUserId(),":",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return m.apply(this,arguments)})},{key:"_renderView",value:function(){r.A.render(this.container,this.data),r.A.afterRender(this.eventHandlers)}},{key:"_handleAddMeal",value:function(){window.location.hash="#/add-meal"}},{key:"_handleDeleteMeal",value:(g=p(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.data.loading=!0,this._renderView(),e.next=5,n.A.deleteMealEntry(t);case 5:return e.next=7,this._refreshDailyData();case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Delete failed for user",this._getCurrentUserId(),":",e.t0),alert("Failed to delete meal. Please try again.");case 13:return e.prev=13,this.data.loading=!1,this._renderView(),e.finish(13);case 17:case"end":return e.stop()}}),e,this,[[0,9,13,17]])}))),function(e){return g.apply(this,arguments)})},{key:"_handleCategoryClicked",value:function(e){var t=this;console.log("Category clicked by user ".concat(this._getCurrentUserId(),": ").concat(e)),this.data.currentCategory=e,setTimeout((function(){r.A.showCategoryPopup(e,t.data.selectedKeywords)}),100)}},{key:"_handlePopupClosed",value:function(){console.log("Popup closed for user:",this._getCurrentUserId()),this.data.currentCategory=null,r.A.hideCategoryPopup(),this._renderView()}},{key:"_handleKeywordToggled",value:function(e,t){if(console.log("User ".concat(this._getCurrentUserId()," keyword ").concat(e," ").concat(t?"selected":"deselected")),0!==(0,s.Rd)([e]).length){if(t){if(this.data.selectedKeywords.length>=6)return alert("Maximum 6 keywords allowed! Please remove some keywords first."),void setTimeout((function(){var t=document.querySelector('[data-keyword="'.concat(e,'"]'));t&&t.classList.remove("selected")}),100);this.data.selectedKeywords.includes(e)||this.data.selectedKeywords.push(e)}else this.data.selectedKeywords=this.data.selectedKeywords.filter((function(t){return t!==e}));this._saveToSessionStorage();var a=(0,s.sh)(this.data.selectedKeywords);console.log("Selected keywords by category for user",this._getCurrentUserId(),":",a),console.log("Total selected keywords for user",this._getCurrentUserId(),":",this.data.selectedKeywords)}else console.warn("Invalid keyword: ".concat(e))}},{key:"_handleFindMeals",value:(d=p(h().mark((function e(){var t,a,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Finding meals with keywords for user",this._getCurrentUserId(),":",this.data.selectedKeywords),0!==this.data.selectedKeywords.length){e.next=4;break}return alert("Please select some preferences first!"),e.abrupt("return");case 4:if(!(this.data.selectedKeywords.length>6)){e.next=7;break}return alert("Maximum 6 keywords allowed! Please remove some keywords first."),e.abrupt("return");case 7:return e.prev=7,this.data.mealSuggestions.loading=!0,this.data.mealSuggestions.error=null,this.data.mealSuggestions.isFromAPI=!0,this._renderView(),console.log("🔍 Fetching meal suggestions from API for user:",this._getCurrentUserId()),console.log("Keywords:",this.data.selectedKeywords),e.next=16,n.A.getMealSuggestions(this.data.selectedKeywords);case 16:t=e.sent,console.log("✅ Meal suggestions received for user",this._getCurrentUserId(),":",t),t&&t.suggestions&&t.suggestions.length>0?(a=t.suggestions.map((function(e){return{id:e.recipe_id,name:e.name,calories:e.calories,image:e.image_url||"https://images.unsplash.com/photo-1546554137-f86b9593a222?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",serving_size:e.serving_size||1,serving_unit:e.serving_unit||"serving",protein:e.protein,carbohydrate:e.carbohydrate,fat:e.fat}})),this.data.mealSuggestions.data=a,this.data.suggestedMeals=a.slice(0,8),this.data.mealSuggestions.loading=!1,this.data.mealSuggestions.error=null,this.data.mealSuggestions.isFromAPI=!0,this._saveToSessionStorage(),console.log("✅ Meal suggestions formatted successfully for user:",this._getCurrentUserId()),console.log("Total suggestions:",a.length),alert("Found ".concat(a.length," meal suggestions based on your preferences!"))):(console.log("⚠️ No suggestions found for user",this._getCurrentUserId(),", using fallback"),this._useFallbackSuggestions(),alert("No specific suggestions found for your keywords. Showing general recommendations.")),e.next=29;break;case 21:e.prev=21,e.t0=e.catch(7),console.error("💥 Error fetching meal suggestions for user",this._getCurrentUserId(),":",e.t0),r="Failed to get meal suggestions",e.t0.message.includes("Profile not found")||e.t0.message.includes("404")?r="Please complete your profile first to get personalized suggestions.":e.t0.message.includes("Daily calorie target")||e.t0.message.includes("400")?r="Please set your daily calorie target in profile to get suggestions.":e.t0.message.includes("503")||e.t0.message.includes("service")?r="Meal suggestion service is temporarily unavailable. Using default suggestions.":e.t0.message.includes("504")||e.t0.message.includes("timeout")?r="Request timeout. Using default suggestions.":e.t0.message.includes("Network error")&&(r="Network error. Please check your connection."),this.data.mealSuggestions.error=r,this._useFallbackSuggestions(),alert(r);case 29:return e.prev=29,this.data.mealSuggestions.loading=!1,this._saveToSessionStorage(),this._renderView(),e.finish(29);case 34:case"end":return e.stop()}}),e,this,[[7,21,29,34]])}))),function(){return d.apply(this,arguments)})},{key:"_useFallbackSuggestions",value:function(){this.data.mealSuggestions.data=[{id:"default_1",name:"Chicken Soto",image:"./public/image/meals/chicken-soto.jpg",calories:312,serving_size:1,serving_unit:"serving"},{id:"default_2",name:"Fried Noodles",image:"./public/image/meals/fried-noodles.jpg",calories:280,serving_size:1,serving_unit:"serving"},{id:"default_3",name:"Meatballs Soup",image:"./public/image/meals/meatballs-soup.jpg",calories:283,serving_size:1,serving_unit:"serving"},{id:"default_4",name:"Noodles Soup",image:"./public/image/meals/noodles-soup.jpg",calories:137,serving_size:1,serving_unit:"serving"}],this.data.suggestedMeals=this.data.mealSuggestions.data,this.data.mealSuggestions.loading=!1,this.data.mealSuggestions.error=null,this.data.mealSuggestions.isFromAPI=!1,this._saveToSessionStorage()}},{key:"_handleClearAll",value:function(){console.log("Clearing all selected keywords for user:",this._getCurrentUserId()),this.data.selectedKeywords=[],this._useFallbackSuggestions(),this.data.mealSuggestions.loading=!1,this.data.mealSuggestions.error=null,this.data.mealSuggestions.isFromAPI=!1,this._saveToSessionStorage(),this._renderView()}},{key:"_handleKeywordRemoved",value:function(e){console.log("User ".concat(this._getCurrentUserId()," removing keyword: ").concat(e)),this.data.selectedKeywords=this.data.selectedKeywords.filter((function(t){return t!==e})),this._saveToSessionStorage();var t=(0,s.sh)(this.data.selectedKeywords);console.log("Updated keywords by category for user",this._getCurrentUserId(),":",t),this._renderView()}},{key:"_handleGenerateMealPlan",value:(l=p(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchMealPlan(!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"_handleMealPlanItemClicked",value:function(e){console.log("Meal plan item clicked by user",this._getCurrentUserId(),":",e),window.FoodCard&&window.FoodCard.showAddMealPopup&&window.FoodCard.showAddMealPopup({id:e.id,name:e.name,calories:e.calories,serving_size:e.serving_size,serving_unit:e.serving_unit})}},{key:"_handleCompleteProfile",value:function(){console.log("Complete profile clicked by user:",this._getCurrentUserId()),window.location.hash="#/profile"}},{key:"_handleSuggestedMealClicked",value:function(e){console.log("Suggested meal clicked for adding by user",this._getCurrentUserId(),":",e),this._showSuggestionMealPopup({id:e.id,name:e.name,calories:e.calories,serving_size:e.serving_size||1,serving_unit:e.serving_unit||"serving"})}},{key:"_showSuggestionMealPopup",value:function(e){var t=this;console.log("Showing suggestion meal popup for user",this._getCurrentUserId(),":",e);var a=document.getElementById("suggestion-meal-popup-overlay");a&&a.remove();var r='\n      <div class="meal-popup-overlay" id="suggestion-meal-popup-overlay">\n        <div class="meal-popup">\n          <div class="meal-popup-header">\n            <h3>Add '.concat(e.name,'</h3>\n            <button class="popup-close" id="suggestion-popup-close">&times;</button>\n          </div>\n          <div class="meal-popup-content">\n            <div class="form-group">\n              <label for="suggestion-meal-type">Meal Type:</label>\n              <select id="suggestion-meal-type" required>\n                <option value="">Select meal type</option>\n                <option value="breakfast">Breakfast</option>\n                <option value="lunch">Lunch</option>\n                <option value="dinner">Dinner</option>\n                <option value="snack">Snack</option>\n              </select>\n            </div>\n            <div class="form-group">\n              <label for="suggestion-servings">Servings:</label>\n              <input type="number" id="suggestion-servings" min="1" step="1" value="1" required>\n            </div>\n            <div class="form-group">\n              <label for="suggestion-log-date">Date:</label>\n              <input type="date" id="suggestion-log-date" value="').concat(this._getTodayString(),'" required>\n            </div>\n            <div class="form-actions">\n              <button class="btn-cancel" id="suggestion-btn-cancel">Cancel</button>\n              <button class="btn-add" id="suggestion-btn-add">Add</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",r);var i=document.getElementById("suggestion-meal-popup-overlay"),s=document.getElementById("suggestion-popup-close"),o=document.getElementById("suggestion-btn-cancel"),l=document.getElementById("suggestion-btn-add");function c(){i&&i.parentNode&&i.parentNode.removeChild(i)}s&&s.addEventListener("click",c),o&&o.addEventListener("click",c),i&&i.addEventListener("click",(function(e){e.target===i&&c()})),l&&l.addEventListener("click",p(h().mark((function a(){var r,i,s,o,d,u,g;return h().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=null===(r=document.getElementById("suggestion-meal-type"))||void 0===r?void 0:r.value,d=parseFloat(null===(i=document.getElementById("suggestion-servings"))||void 0===i?void 0:i.value),u=null===(s=document.getElementById("suggestion-log-date"))||void 0===s?void 0:s.value,o&&d&&u){a.next=6;break}return alert("Please fill all fields"),a.abrupt("return");case 6:if(a.prev=6,l.disabled=!0,l.textContent="Adding...",!e.id||e.id.startsWith("default_")){a.next=19;break}return g={recipe_id:e.id,meal_type:o,servings:d,log_date:u},a.next=13,n.A.addMealFromSuggestion(g);case 13:return alert("Meal added successfully!"),c(),a.next=17,t._refreshDailyData();case 17:a.next=22;break;case 19:console.log("Demo: Added ".concat(e.name," - ").concat(o," - ").concat(d," servings on ").concat(u," for user ").concat(t._getCurrentUserId())),alert('This is a default meal. Please select suggestions from "Find Meals" for full functionality.'),c();case 22:a.next=30;break;case 24:a.prev=24,a.t0=a.catch(6),console.error("Error adding meal from suggestion for user",t._getCurrentUserId(),":",a.t0),alert("Failed to add meal. Please try again."),l.disabled=!1,l.textContent="Add";case 30:case"end":return a.stop()}}),a,null,[[6,24]])}))))}},{key:"_handleSuggestedMealDetailsClicked",value:(o=p(h().mark((function e(t){var a,r,i,s,o,l,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Suggested meal details clicked by user",this._getCurrentUserId(),":",t),t.id&&!t.id.startsWith("default_")){e.next=4;break}return this._showMealDetailsPopup({name:t.name,calories:t.calories,image:t.image,serving_size:t.serving_size||1,serving_unit:t.serving_unit||"serving",protein:t.protein||0,carbohydrate:t.carbohydrate||0,fat:t.fat||0,isDefault:!0}),e.abrupt("return");case 4:return e.prev=4,console.log("🔍 Fetching meal details from API for user:",this._getCurrentUserId()),this._showMealDetailsPopup({name:t.name,loading:!0}),e.next=9,n.A.getMealDetails(t.id);case 9:if(a=e.sent,console.log("✅ Meal details received for user",this._getCurrentUserId(),":",a),!a||!a.meal){e.next=16;break}c=a.meal,this._showMealDetailsPopup({name:c.food_name,calories:c.calories_per_serving,image:c.image_url,serving_size:c.serving_size,serving_unit:c.serving_unit,protein:c.protein_per_serving,carbohydrate:c.carbs_per_serving,fat:c.fat_per_serving,cookTime:null===(r=c.recipe_metadata)||void 0===r?void 0:r.cook_time,prepTime:null===(i=c.recipe_metadata)||void 0===i?void 0:i.prep_time,totalTime:null===(s=c.recipe_metadata)||void 0===s?void 0:s.total_time,ingredients:null===(o=c.recipe_metadata)||void 0===o?void 0:o.ingredients,nutrition:null===(l=c.recipe_metadata)||void 0===l?void 0:l.total_nutrition,isDefault:!1}),e.next=17;break;case 16:throw new Error("No meal details found");case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(4),console.error("💥 Error fetching meal details for user",this._getCurrentUserId(),":",e.t0),this._showMealDetailsPopup({name:t.name,error:"Failed to load meal details. Please try again.",calories:t.calories,image:t.image});case 23:case"end":return e.stop()}}),e,this,[[4,19]])}))),function(e){return o.apply(this,arguments)})},{key:"_showMealDetailsPopup",value:function(e){var t=document.getElementById("meal-details-popup-overlay");t&&t.remove();var a="";a=e.loading?'\n        <div class="meal-details-loading">\n          <div class="loading-spinner"></div>\n          <p>Loading meal details...</p>\n        </div>\n      ':e.error?'\n        <div class="meal-details-error">\n          <h4>Error</h4>\n          <p>'.concat(e.error,'</p>\n          <div class="basic-meal-info">\n            <img src="').concat(e.image||"https://images.unsplash.com/photo-1546554137-f86b9593a222",'" alt="').concat(e.name,'">\n            <h3>').concat(e.name,"</h3>\n            <p>").concat(e.calories||0," kcal per serving</p>\n          </div>\n        </div>\n      "):'\n        <div class="meal-details-content">\n          <div class="meal-details-header">\n            <img src="'.concat(e.image||"https://images.unsplash.com/photo-1546554137-f86b9593a222",'" alt="').concat(e.name,'">\n            <div class="meal-basic-info">\n              <h3>').concat(e.name,'</h3>\n              <p class="meal-calories">').concat(e.calories," kcal per ").concat(e.serving_unit||"serving","</p>\n              ").concat(e.totalTime?'<p class="meal-time">⏱️ '.concat(e.totalTime," minutes</p>"):"",'\n            </div>\n          </div>\n          \n          <div class="meal-nutrition">\n            <h4>Nutrition per serving:</h4>\n            <div class="nutrition-grid">\n              <div class="nutrition-item">\n                <span class="nutrition-label">Protein</span>\n                <span class="nutrition-value">').concat(Math.round(e.protein||0),'g</span>\n              </div>\n              <div class="nutrition-item">\n                <span class="nutrition-label">Carbs</span>\n                <span class="nutrition-value">').concat(Math.round(e.carbohydrate||0),'g</span>\n              </div>\n              <div class="nutrition-item">\n                <span class="nutrition-label">Fat</span>\n                <span class="nutrition-value">').concat(Math.round(e.fat||0),"g</span>\n              </div>\n            </div>\n          </div>\n\n          ").concat(e.ingredients&&e.ingredients.length>0?'\n            <div class="meal-ingredients">\n              <h4>Ingredients:</h4>\n              <ul>\n                '.concat(e.ingredients.slice(0,10).map((function(e){return"<li>".concat(e,"</li>")})).join(""),"\n                ").concat(e.ingredients.length>10?"<li><em>... and ".concat(e.ingredients.length-10," more ingredients</em></li>"):"","\n              </ul>\n            </div>\n          "):"","\n\n          ").concat(e.nutrition?'\n            <div class="detailed-nutrition">\n              <h4>Detailed Nutrition:</h4>\n              <div class="nutrition-details-grid">\n                '.concat(e.nutrition.fiber?"<div>Fiber: ".concat(Math.round(e.nutrition.fiber),"g</div>"):"","\n                ").concat(e.nutrition.sugar?"<div>Sugar: ".concat(Math.round(e.nutrition.sugar),"g</div>"):"","\n                ").concat(e.nutrition.sodium?"<div>Sodium: ".concat(Math.round(e.nutrition.sodium),"mg</div>"):"","\n                ").concat(e.nutrition.cholesterol?"<div>Cholesterol: ".concat(Math.round(e.nutrition.cholesterol),"mg</div>"):"","\n              </div>\n            </div>\n          "):"","\n        </div>\n      ");var r='\n      <div class="meal-details-popup-overlay" id="meal-details-popup-overlay">\n        <div class="meal-details-popup">\n          <div class="meal-details-popup-header">\n            <h2>Meal Details</h2>\n            <button class="popup-close" id="meal-details-close">&times;</button>\n          </div>\n          <div class="meal-details-popup-body">\n            '.concat(a,"\n          </div>\n        </div>\n      </div>\n    ");document.body.insertAdjacentHTML("beforeend",r);var n=document.getElementById("meal-details-popup-overlay"),i=document.getElementById("meal-details-close"),s=function(){n&&n.parentNode&&n.parentNode.removeChild(n)};i&&i.addEventListener("click",s),n&&n.addEventListener("click",(function(e){e.target===n&&s()}));var o=function(e){"Escape"===e.key&&(s(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o)}}],t&&f(e.prototype,t),a&&f(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a,o,l,d,g,m,v,_,y,b}()}}]);
//# sourceMappingURL=app~28c8c3f7.bundle.js.map